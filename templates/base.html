<!DOCTYPE html>
<html>
<head>
    <title>LOGåˆ†æå„€</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=3">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ” LOGåˆ†æå„€</h1>
            <p>è¼•é‡ç´šApache/Nginx LOGåˆ†æå·¥å…·</p>
            <div class="version-info">v{{ current_time }}</div>
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section">
            <h3>ğŸ” éæ¿¾æ¢ä»¶</h3>
            <form id="filterForm">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="filename">LOGæª”æ¡ˆ</label>
                        <select id="filename" name="filename">
                            <option value="">æ‰€æœ‰æª”æ¡ˆ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="start_time">é–‹å§‹æ™‚é–“</label>
                        <input type="datetime-local" id="start_time" name="start_time">
                    </div>
                    <div class="filter-group">
                        <label for="end_time">çµæŸæ™‚é–“</label>
                        <input type="datetime-local" id="end_time" name="end_time">
                    </div>
                    <div class="filter-group">
                        <label for="time_interval">æ™‚é–“é–“éš”</label>
                        <select id="time_interval" name="time_interval">
                            <option value="hourly">æ¯å°æ™‚</option>
                            <option value="daily" selected>æ¯æ—¥</option>
                            <option value="weekly">æ¯é€±</option>
                            <option value="monthly">æ¯æœˆ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="domain">ç¶²åŸŸéæ¿¾</label>
                        <input type="text" id="domain" name="domain" placeholder="ä¾‹å¦‚: example.com">
                    </div>
                </div>
                <div class="filter-actions">
                    <button type="button" class="btn btn-primary" onclick="applyFilters()">
                        <span>ğŸ”</span> å¥—ç”¨éæ¿¾
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="clearFilters()">
                        <span>ğŸ—‘ï¸</span> æ¸…é™¤éæ¿¾
                    </button>
                    <button type="button" class="btn btn-success" onclick="runAnalysis()">
                        <span>ğŸ“Š</span> åŸ·è¡Œåˆ†æ
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Stats Section -->
        <div class="stats-section">
            <h3>ğŸ“Š åŸºæœ¬çµ±è¨ˆ</h3>
            <div class="stats-grid" id="basic-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalRequests">{{ stats.get('total_requests', 0) }}</div>
                    <div class="stat-label">ç¸½è«‹æ±‚æ•¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uniqueIPs">{{ stats.get('unique_ips', 0) }}</div>
                    <div class="stat-label">å”¯ä¸€IPæ•¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalBytes">{{ "%.1f"|format(stats.get('total_bytes', 0)/1024/1024) }}</div>
                    <div class="stat-label">ç¸½æµé‡ (MB)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgResponseTime">{{ "%.0f"|format(stats.get('avg_response_size', 0)) }}</div>
                    <div class="stat-label">å¹³å‡å›æ‡‰ (bytes)</div>
                </div>
            </div>
        </div>
            
        <!-- Info Cards Section -->
        <div class="info-cards-grid">
            <!-- Time Range -->
            <div class="card" id="time-range">
                <div class="card-header">
                    <span class="card-icon">â°</span>
                    <span class="card-title">æ™‚é–“ç¯„åœ</span>
                </div>
                <div id="timeRangeContent">
                    <p>é–‹å§‹: <span id="startTimeDisplay">-</span></p>
                    <p>çµæŸ: <span id="endTimeDisplay">-</span></p>
                </div>
            </div>
            
            <!-- Top URLs -->
            <div class="card" id="top-urls">
                <div class="card-header">
                    <span class="card-icon">ğŸ”—</span>
                    <span class="card-title">ç†±é–€URL</span>
                </div>
                <div id="topUrlsContent">
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>
            
            <!-- Top IPs -->
            <div class="card" id="top-ips">
                <div class="card-header">
                    <span class="card-icon">ğŸŒ</span>
                    <span class="card-title">ç†±é–€IP</span>
                </div>
                <div id="topIpsContent">
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>
        
        <!-- Log Viewer Section -->
        <div class="log-viewer log-viewer-full">
            <h3>ğŸ“‹ LOGæŸ¥çœ‹å™¨</h3>
            <div class="log-controls">
                <div class="log-search">
                    <input type="text" id="logSearch" placeholder="æœå°‹é—œéµå­—..." onkeyup="searchLogs()">
                    <select id="pageSize" onchange="changePageSize()">
                        <option value="10" selected>10ç­†/é </option>
                        <option value="25">25ç­†/é </option>
                        <option value="50">50ç­†/é </option>
                        <option value="100">100ç­†/é </option>
                    </select>
                </div>
            </div>
            <table class="log-table" id="logTable">
                <thead>
                    <tr>
                        <th>æ™‚é–“</th>
                        <th>IP</th>
                        <th>ç‹€æ…‹ç¢¼</th>
                        <th>æ–¹æ³•</th>
                        <th>URL</th>
                        <th>å¤§å°</th>
                        <th>User Agent</th>
                    </tr>
                </thead>
                <tbody id="logTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">è¼‰å…¥ä¸­...</td>
                    </tr>
                </tbody>
            </table>
            <div class="pagination" id="logPagination">
                <!-- åˆ†é æŒ‰éˆ•å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="charts-grid">
            <!-- Traffic Trend Chart -->
            <div class="chart-container chart-full">
                <h3>ğŸ“ˆ æµé‡è¶¨å‹¢</h3>
                <div class="chart">
                    <img id="trafficTrendChart" src="" alt="æµé‡è¶¨å‹¢åœ–" style="display: none;">
                </div>
            </div>
            
            <!-- Top IPs Chart -->
            <div class="chart-container chart-full">
                <h3>ğŸŒ ç†±é–€IPåˆ†å¸ƒ</h3>
                <div class="chart">
                    <img id="topIpsChart" src="" alt="ç†±é–€IPåˆ†å¸ƒåœ–" style="display: none;">
                </div>
            </div>
            
            <!-- Top URLs Chart -->
            <div class="chart-container chart-full">
                <h3>ğŸ”— ç†±é–€URLåˆ†å¸ƒ</h3>
                <div class="chart">
                    <img id="topUrlsChart" src="" alt="ç†±é–€URLåˆ†å¸ƒåœ–" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- API Section -->
        <div class="api-section">
            <h3>ğŸ”— APIç«¯é»</h3>
            <div class="endpoint">
                <span class="method">GET</span> /api/stats - ç²å–çµ±è¨ˆè³‡æ–™
            </div>
            <div class="endpoint">
                <span class="method">GET</span> /api/logs - ç²å–LOGè³‡æ–™
            </div>
            <div class="endpoint">
                <span class="method">GET</span> /api/analyze - åŸ·è¡Œåˆ†æ
            </div>
            <div class="endpoint">
                <span class="method">GET</span> /api/chart/&lt;chart_type&gt; - ç²å–åœ–è¡¨
            </div>
            <div class="endpoint">
                <span class="method">GET</span> /health - å¥åº·æª¢æŸ¥
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/app.js') }}?v=3"></script>
</body>
</html>
